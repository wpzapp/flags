sudo: false
language: php
cache:
  directories:
  - vendor
  - $HOME/.composer/cache
matrix:
  include:
  - php: 7.1
    env: PHPLINT=1 COVERAGE=1
  - php: 7.0
  allow_failures:
  - php: nightly
before_script:
- composer self-update
- composer install
script:
- |
  if [[ "$PHPLINT" == "1" ]]; then
    find -L .  -path ./vendor -prune -o -name '*.php' -print0 | xargs -0 -n 1 -P 4 php -l
  fi
- |
  if [[ -z "$CODECLIMATE_REPO_TOKEN" ]]; then
    COVERAGE="0"
  fi
- |
  if [[ "$COVERAGE" == "1" ]]; then
    mkdir -p build/logs
    vendor/bin/phpunit -c phpunit.xml --coverage-clover build/logs/clover.xml
    vendor/bin/test-reporter;
  else
    vendor/bin/phpunit -c phpunit.xml
  fi
notifications:
  email: false
  slack:
    rooms:
      secure: Y4L3RvAf72CYnI2gfcHDeHtsL3wxtwgh7hZj1mYLtvvsiWAcIm6vn2cj6s6PkX+zJi/S8VKNhXt5QrC5wP+TnFJrhNJ5zfK0QSr6teiswkJs0yxbJqqnuG5rPQsMBE3XmN/HznVnfcC0psR2cGRZWnAMVEidri+xNmkS81T1kOZfzr2h8QYFan9vtu4L9qEZaBFVSInOFg34LvaVtg+ukiXIQAgipPXo1tQYt3vxBWKSmapfKrnyXq+0QFRf0BFirX/yOxQ6+brm/Dp1n1TouLTuEDsOW3amAIOiD2JzmKc4JS5QJ4qnhGgUvY4C35KD9Wus+n2xXhJpFKi/JnHXy8t8GWEbFSU1y9F66jlLkb1FBTL/DhIPKg3XzNFQjqv6SN2/mN1CNMiUHy8vjuBG0gOEnLKQNeWYE9+JrElrC+G1eLDtuZfQdCqKAlcL3bNPOk3VBG97Cjld/PdkdyKNNf+jUt83VH4k3v9eviKFR2FsFHeRFS7qt8CL2JUejwZ5pV/yTdvaPOAQnuP4x0+1ewgDV0SrPegcCUP8RsyOGLChQpXZUSVSRLapo7S6EcnbLre23rA/NygL3f+sN+Q9y8XZtfij6kBAIby21LW/H6ejRFFdFVG5/S5bq4MvyFgP67wVpJKuP7U/7m4IRP/+1T03cUyrKGl8ZlkEfMbdVuI=
    on_success: change
    on_failure: always
